<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Santa Cruz Pizza Delivery Game</title>
  <!-- Leaflet CSS (OpenStreetMap) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Game CSS -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Intro screen with logo and music -->
  <div id="intro">
    <img id="logo" src="images/logo.png" alt="Joby Pizza Delivery Services logo" />
    <!-- Start button pulses to attract attention -->
    <button id="start-btn" class="pulse">Start Game</button>
    <!-- Looping music for the intro screen. Use preload so the file is ready, but rely on JS to start playback after a user gesture to satisfy autoplay policies. -->
    <audio id="intro-audio" src="audio/intro.mp3" loop preload="auto"></audio>
    <!-- Background music for the game itself. Paused by default; will start on Start button click -->
    <audio id="game-audio" src="audio/game.mp3" loop preload="auto"></audio>
  </div>

  <!-- Map container -->
  <div id="map" style="display:none;"></div>

  <!-- Heads-up display for score and time -->
  <div id="hud" style="display:none;">Deliveries: 0/10 | Time: 60</div>

  <!-- Phone icon for incoming orders -->
  <div id="phone-icon" style="display:none; position:absolute; top:60px; right:10px; font-size:40px; cursor:pointer; z-index:1000;">ðŸ“ž</div>
  <div id="phone-message" style="display:none; position:absolute; top:60px; right:60px; z-index:1000; background:rgba(0,0,0,0.8); color:#fff; padding:5px 10px; border-radius:8px; font-size:16px;"></div>

  <!-- Final game-over screen (hidden by default) -->
  <div id="game-over">
    <div id="game-over-content"></div>
  </div>

  <!-- Leaflet JS library -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="leaflet.edgebuffer.js"></script>

  <!-- Simple script to handle the start button and audio -->
  <script>
    // Once the DOM is loaded, attach the start handler
    document.addEventListener('DOMContentLoaded', () => {
      const startBtn = document.getElementById('start-btn');
      const introMusic = document.getElementById('intro-audio');

      /**
       * Attempt to play the intro music. If autoplay is blocked by the browser,
       * the returned promise will reject. We ignore the error here because we
       * will try again when the user interacts with the page.
       */
      function attemptPlay() {
        introMusic.play().catch(() => {
          // Autoplay blocked; will try again on next interaction
        });
      }

      // Try to autoplay on page load. Some browsers (e.g. Safari) may allow it.
      attemptPlay();

      // When the user clicks the Start button, ensure the music plays if it
      // hasn't already started, then reveal the game UI and load the game code.
      startBtn.addEventListener('click', () => {
        // If the intro music isn't playing yet, start it and update the button text.
        if (introMusic.paused) {
          // Attempt to start the intro music. If autoplay is blocked this will
          // reject silently; the user can click again to retry.
          attemptPlay();
          // Update the button label to indicate the next click will start the game.
          startBtn.textContent = 'Play Game';
          return; // stay on intro screen so the music can be heard
        }
        // Music is already playing, so stop it and proceed to launch the game.
        introMusic.pause();
        introMusic.currentTime = 0;
        // Start the game background music.
        const gameAudioElem = document.getElementById('game-audio');
        if (gameAudioElem && gameAudioElem.paused) {
          gameAudioElem.play().catch(() => {});
        }
        // Hide the intro screen and show the map and HUD.
        document.getElementById('intro').style.display = 'none';
        document.getElementById('map').style.display = 'block';
        document.getElementById('hud').style.display = 'block';
        // Lazyâ€‘load the game script to keep the initial page lightweight.
        const script = document.createElement('script');
        script.src = 'game.js';
        document.body.appendChild(script);
      });
    });
  </script>
</body>
</html>
